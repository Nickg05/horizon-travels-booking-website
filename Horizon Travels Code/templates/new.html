<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Responsive Navbar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}" />
  </head>
  <body>
    <nav>
      <input type="checkbox" id="check" />
      <label for="check" class="checkbtn">
        <img src="/static/hamburger.png" alt="Menu" />
      </label>
      <label class="logo">Horizon Travels</label>
      <ul>
        <li><a class="active" href="#">Home</a></li>
        <li><a href="#">Manage Bookings</a></li>
        <li><a href="#">Search</a></li>
        <li><a href="#">About us</a></li>
        {% if session.get('logged_in') %}
          <li><a href="{{ url_for('logout') }}">Logout</a></li>
        {% else %}
          <li><a href="{{ url_for('login') }}">Login/Register</a></li>
        {% endif %}
      </ul>
    </nav>

    <div class="background"></div>
    <section>
      <div class="container">
        <div class="dropdown-container">
          <!-- Departing From label -->
          <div class="dropdown">
            <p style="color: white;">Departing From</p>
            <button class="dropdown-btn">Select Departure</button>
            <div class="dropdown-menu" id="departure-list">
              {% for departure in departures %}
                <a href="#" class="dropdown-option" data-departure="{{ departure['departure'] }}">{{ departure['departure'] }}</a>
              {% endfor %}
            </div>
          </div>
          <!-- Arrival label (formerly destination) -->
          <div class="dropdown">
            <p style="color: white;">Arrival</p>
            <button class="dropdown-btn" id="arrival-btn">Select Arrival</button>
            <div class="dropdown-menu" id="arrival-list">
              <!-- Arrival options will be populated dynamically -->
            </div>
          </div>

          <!-- Date Picker -->
          <div class="dropdown">
            <p style="color: white;">Select Date</p>
            <input type="date" id="travel-date" class="dropdown-btn" />
          </div>

          <button class="submit-btn">Submit</button>
        </div>

        <!-- Move the customer reviews to item-3 -->
        <div class="item-3">
          <h2>What Our Customers Say</h2>
          <blockquote>"Horizon Travels made my trip planning so easy and affordable!"<footer>- Jane Doe</footer></blockquote>
          <blockquote>"I loved the seamless experience of booking with Horizon Travels."<footer>- John Smith</footer></blockquote>
        </div>

        <!-- Now item-2 is empty or can be used for other content -->
        <div class="item-2">
          <!-- This section is now empty or you can move other content here -->
        </div>

        <div class="item-3">3</div>
      </div>
    </section>

    <!-- JavaScript -->
    <script>
      // Function to remove active class from all options
      function removeActiveClass() {
        const options = document.querySelectorAll('.dropdown-option');
        options.forEach(option => {
          option.classList.remove('active-option');
        });
      }

      // Function to set the date picker limits
      function setDatePickerLimit() {
        const today = new Date();
        const maxDate = new Date();
        
        // Set the max date to 3 months ahead
        maxDate.setMonth(today.getMonth() + 3);
        
        // Format the date to YYYY-MM-DD (required format for the date input)
        const formattedMaxDate = maxDate.toISOString().split('T')[0];
        
        // Set the 'max' attribute for the date picker to limit it to 3 months ahead
        const datePicker = document.getElementById('travel-date');
        datePicker.setAttribute('max', formattedMaxDate);

        // Optionally, set the 'min' attribute to today's date (if not already set by the browser)
        const formattedToday = today.toISOString().split('T')[0];
        datePicker.setAttribute('min', formattedToday);
      }

      // Add event listeners to departure dropdown options
      document.querySelectorAll('.dropdown-option').forEach(option => {
        option.addEventListener('click', function() {
          removeActiveClass();
          this.classList.add('active-option');
          
          // Set the departure button text
          const departureButton = this.closest('.dropdown').querySelector('.dropdown-btn');
          departureButton.textContent = this.textContent;

          const selectedDeparture = this.getAttribute('data-departure');
          
          // Fetch arrivals based on the selected departure
          fetch(`/get_arrival?departure=${selectedDeparture}`)

            .then(response => response.json())
            .then(data => {
              if (data.arrival) {
                const arrivalList = document.getElementById('arrival-list');
                arrivalList.innerHTML = '';  // Clear previous options

                // Populate the arrival dropdown with new options
                data.arrival.forEach(arrival => {
                  const arrivalOption = document.createElement('a');
                  arrivalOption.href = '#';
                  arrivalOption.classList.add('dropdown-option');
                  arrivalOption.textContent = arrival.arrival;  // This field should match the DB column name
                  arrivalList.appendChild(arrivalOption);
                });

                // Add event listeners to newly added arrival options
                document.querySelectorAll('.dropdown-option').forEach(arrivalOption => {
                  arrivalOption.addEventListener('click', function() {
                    removeActiveClass();
                    this.classList.add('active-option');
                    
                    // Set the arrival button text
                    const arrivalButton = document.getElementById('arrival-btn');
                    arrivalButton.textContent = this.textContent;
                  });
                });
              } else {
                // Handle any errors from the backend
                console.error('Error fetching arrivals:', data.error);
              }
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
      });

      // Call the function to set date picker limit on page load
      document.addEventListener('DOMContentLoaded', setDatePickerLimit);
    </script>
  </body>
</html>
